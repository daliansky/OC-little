# AOAC补丁方法

## AOAC技术

- 新的笔记本电脑引入了一项新技术—— `AOAC` ，即：*Always On/Always Connected* 。 `AOAC` 由 `Intel` 提出，旨在电脑在睡眠或者休眠模式下仍然保持网络连接及资料传输。简单的说，  `AOAC` 的引入使笔记本和我们的手机一样，永不关机，永远在线。
- 有关`AOAC`方面的内容请百度 `AOAC` 、 `联想AOAC` 、 `AOAC网卡` 等。

## AOAC问题

### 睡眠失败问题

- 由于 `AOAC` 和 `S3` 本身相矛盾，采用了 `AOAC` 技术的机器不具有 `S3` 睡眠功能，如 `Lenovo PRO13` 。这样的机器一旦进入 `S3` 睡眠就会 **睡眠失败** 。 **睡眠失败** 主要表现为：睡眠后无法被唤醒，呈现死机状态，只能强制关机。**睡眠失败** 本质是机器一直停滞在睡眠过程，始终没有睡眠成功。
- 有关 `S3` 睡眠方面内容参见《ACPI 规范》。

### 待机时间问题

- **禁止`S3`睡眠** 可以解决 **睡眠失败** 问题，但是机器将不再睡眠。没有了睡眠随之而来的问题是：在电池供电模式下，机器待机时间大大缩短。比如，在"菜单睡眠"、"自动睡眠"、"盒盖睡眠"等情况下，电池耗电量较大，大约每小时耗电5%--10%。

## AOAC解决方案

-  **禁止`S3`睡眠** 
- 延长待机时间
  - 关闭独显的供电电源
  - 优化SSD固态硬盘的电源管理
    - 选择品质较好的SSD：SLC>MLC>TLC>QLC（不确定）
    - 可能的话更新SSD固件以提高电源管理的效能
    - 使用SSDT-DeepIdle提高SSD进入空闲电源管理的可能性
    - 使用NVMeFix.kext开启SSD的APST
    - 启用主板ASPM（BIOS高级选项）。参考：<https://www.sohu.com/a/120850299_505795>

## AOAC睡眠、唤醒

- `AOAC` 睡眠——`AOAC` 睡眠使系统、硬件进入了空闲状态，非传统意义上的睡眠。
- `AOAC` 唤醒——`AOAC` 唤醒比较困难，通常需要电源键+PNP0C0D唤醒，见后文的 `亮屏唤醒补丁` 。

## AOAC补丁

-  ***SSDT-S3-disable*** —— **禁止`S3`睡眠** 补丁

-  ***SSDT-DeepIdle*** —— `DeepIdle` 补丁

  详细内容参见：<https://pikeralpha.wordpress.com/2017/01/12/debugging-sleep-issues/>

-  `亮屏唤醒补丁` 组合

  - ***SSDT-LIDpatch-AOAC*** —— `亮屏通用补丁` ，使用时应保证 `PNP0C0D` 路径和 `ACPI` 路径一致
  
  - ***SSDT-FnQ-AOACWake*** ——小新PRO13 `按键唤醒补丁` ，按键：`Fn+Q` 
  
  - ***SSDT-FnInsert-AOACWake*** ——dell5480`按键唤醒补丁` ，按键：`Fn+Insert` 
  
      附： `PNP0C0D` 唤醒条件：
  
    - `_LID`  返回 `One` 。 `_LID` 是 `PNP0C0D` 设备当前状态。
    - 执行 `Notify(***.LID0, 0x80)`。 `LID0` 是 `PNP0C0D` 设备名称。
    - 参见《PNP0C0E睡眠修正方法》
  
- 禁止独显补丁——参见《AOAC禁止独显》

  **注** ：以上补丁所要求的更名在对应补丁文件的注释里。


## 注意事项

- 本方法是临时解决方案。随着 `AOAC` 技术的广泛应用，可能将来会有更好的解决方法。
- `AOAC` 睡眠、唤醒和 `S3` 睡眠、唤醒无关。以下补丁无需使用：
  - 《PTSWAK综合补丁和扩展补丁》
  - 《PNP0C0E睡眠修正方法》
  - 《0D6D补丁》（可能不需要）
- 同上原因，`AOAC` 睡眠期间无法正确显示工作状态，如无呼吸灯闪烁。
- 非 `AOAC` 机器也可尝试本方法。
